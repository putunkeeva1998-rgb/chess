<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AI Chess Coach Premium</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #2c3e50; color: white; display: flex; flex-direction: column; align-items: center; }
        #board { width: 400px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .coach-card { background: white; color: #333; width: 400px; margin-top: 20px; padding: 20px; border-radius: 12px; }
        .advice-item { background: #f8f9fa; border-left: 5px solid #3498db; padding: 10px; margin: 10px 0; border-radius: 4px; cursor: pointer; transition: 0.2s; }
        .advice-item:hover { background: #eef2f7; transform: translateX(5px); }
        button { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; }
        .loader { display: none; text-align: center; color: #3498db; }
    </style>
</head>
<body>

    <h1>AI Chess Coach</h1>
    <div id="board"></div>

    <div class="coach-card">
        <div id="initial-ui">
            <p style="text-align: center;">Как ты думаешь, какой ход лучший?</p>
            <button onclick="getAdvice()">Спросить совета тренера</button>
        </div>
        
        <div id="loader" class="loader">Тренер анализирует позицию...</div>
        <div id="advice-list"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script>
        var config = {
    draggable: true,
    position: 'start',
    pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
};
var board = Chessboard('board', config);

// СВЯЗЫВАЕМ КОД С HTML ЭЛЕМЕНТАМИ
const list = document.getElementById('advice-list');
const initialUI = document.getElementById('initial-ui');
const loader = document.getElementById('loader');

async function getAdvice() {
    const list = document.getElementById('advice-list');
    const loader = document.getElementById('loader');
    const initialUI = document.getElementById('initial-ui');

    // 1. Показываем, что мы начали работу
    initialUI.style.display = 'none';
    loader.style.display = 'block';
    list.innerHTML = ''; 

    try {
        const response = await fetch('http://127.0.0.1:8000/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fen: board.fen() })
        });

        const data = await response.json();
        loader.style.display = 'none'; // Убираем крутилку

        if (data.advice) {
            // Рисуем советы
            const lines = data.advice.trim().split('\n');
            lines.forEach(line => {
                if(line.trim()) {
                    const div = document.createElement('div');
                    div.className = 'advice-item';
                    div.innerHTML = line;
                    list.appendChild(div);
                }
            });
        } else if (data.error) {
            list.innerHTML = '<div style="color:orange">Тренер просит подождать: ' + data.error + '</div>';
        }

        // Кнопка "Дальше"
        const btn = document.createElement('button');
        btn.innerText = "Я сделал ход. Дальше!";
        btn.onclick = () => { initialUI.style.display = 'block'; list.innerHTML = ''; };
        list.appendChild(btn);

    } catch (err) {
        loader.style.display = 'none';
        // Вместо окна ошибки просто пишем текст внизу
        list.innerHTML = '<div style="color:gray">Связь восстанавливается... Нажми кнопку еще раз через 3 секунды.</div>';
        initialUI.style.display = 'block';
    }
}
    </script>
</body>
</html>
